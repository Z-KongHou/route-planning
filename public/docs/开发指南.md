# 智能路线规划系统 - 开发指南

## 1. 项目概述

本项目是一个基于 **React + Vite** 与 **高德地图 JavaScript API** 开发的纯前端“智能路线规划”系统，用户可以输入起点与终点，系统会自动呈现最优路线，并支持路线收藏、编辑、删除以及本地持久化。

## 2. 开发环境搭建

### 2.1 环境要求

| 环境    | 版本       | 安装方式                                       |
| ------- | ---------- | ---------------------------------------------- |
| Node.js | >= 18      | [官网下载](https://nodejs.org/zh-cn/download/) |
| pnpm    | 最新稳定版 | `npm install -g pnpm`                          |
| Git     | 最新稳定版 | [官网下载](https://git-scm.com/downloads)      |
| VS Code | 最新稳定版 | [官网下载](https://code.visualstudio.com/)     |

### 2.2 项目克隆

```bash
# 克隆项目
git clone https://github.com/your-repo/route-planning.git

# 进入项目目录
cd route-planning
```

### 2.3 依赖安装

```bash
# 使用 pnpm 安装依赖（推荐）
pnpm install

# 或使用 npm
npm install

# 或使用 yarn
yarn install
```

### 2.4 启动开发服务器

```bash
# 使用 pnpm
pnpm dev

# 或使用 npm
npm run dev

# 或使用 yarn
yarn dev
```

开发服务器启动后，访问 `http://localhost:5173` 即可查看应用。

### 2.5 构建项目

```bash
# 使用 pnpm
pnpm build

# 或使用 npm
npm run build

# 或使用 yarn
yarn build
```

构建产物将输出到 `dist` 目录。

### 2.6 预览构建结果

```bash
# 使用 pnpm
pnpm preview

# 或使用 npm
npm run preview

# 或使用 yarn
yarn preview
```

### 2.7 代码检查

```bash
# 使用 pnpm
pnpm lint

# 或使用 npm
npm run lint

# 或使用 yarn
yarn lint
```

## 3. 项目结构

```
├── dist/              # 构建输出目录
├── public/            # 公共静态资源
│   └── docs/          # 项目文档
│       ├── 关于页需求说明.md   # 关于页面需求
│       ├── 开发指南.md         # 开发维护指南
│       ├── 收藏页需求说明.md   # 收藏页面需求
│       ├── 用户手册.md         # 用户使用指南
│       ├── 系统架构.md         # 系统架构设计
│       └── 首页需求说明.md     # 首页需求
├── src/               # 源代码目录
│   ├── assets/        # 项目资源
│   ├── components/    # 组件目录
│   │   ├── AIChatComponent.jsx   # AI聊天组件
│   │   ├── AuthGuard.jsx          # 权限守卫组件
│   │   ├── ControlPanel.jsx       # 控制面板组件
│   │   ├── FavoriteModal.jsx      # 收藏模态框组件
│   │   ├── MapComponent.jsx       # 地图组件
│   │   ├── RouteOptions.jsx       # 路线选项组件
│   │   ├── RouteResult.jsx        # 路线结果组件
│   │   └── SimpleMapTest.jsx      # 简单地图测试组件
│   ├── pages/         # 页面组件
│   │   ├── AboutPage.jsx      # 关于页面
│   │   ├── DocsPage.jsx       # 文档页面
│   │   ├── FavoritesPage.jsx  # 收藏页面
│   │   ├── HomePage.jsx       # 首页（地图 + 路线规划）
│   │   ├── LoginPage.jsx      # 登录页面
│   │   └── TestMapPage.jsx    # 地图测试页面
│   ├── test/          # 测试文件目录
│   ├── utils/         # 工具函数
│   │   ├── auth.js            # 认证相关工具
│   │   └── route.js           # 路线相关工具
│   ├── App.css        # 全局样式
│   ├── App.jsx        # 根组件
│   ├── index.css      # 基础样式
│   ├── index.html     # HTML模板
│   ├── main.jsx       # 入口文件
│   └── routes.jsx     # 路由配置
├── .gitignore         # Git忽略文件
├── README.md          # 项目说明文档
├── eslint.config.js   # ESLint配置
├── package.json       # 项目配置
├── pnpm-lock.yaml     # 依赖锁定文件
├── tailwind.config.js # Tailwind配置
└── vite.config.js     # Vite配置
```

## 4. 核心功能模块开发

### 4.1 地图组件开发

1. 组件结构：

   - `MapComponent.jsx`：负责地图初始化、渲染和事件处理
   - 使用 `@amap/amap-jsapi-loader` 加载高德地图 API
   - 封装地图相关的方法，如添加标记点、绘制路线等

2. 地图初始化流程：

```javascript
// 导入地图加载器
import AMapLoader from '@amap/amap-jsapi-loader';

// 初始化地图
const initMap = async () => {
  const AMap = await AMapLoader.load({
    key: import.meta.env.VITE_AMAP_API_KEY,
    version: '2.0',
    plugins: ['AMap.Driving', 'AMap.Walking', 'AMap.Transfer'],
  });

  // 创建地图实例
  const map = new AMap.Map('map-container', {
    zoom: 12,
    center: [116.397428, 39.90923],
  });

  // 保存地图实例到状态
  setMap(map);
};
```

### 4.2 路线规划功能开发

- 组件结构：
  - `RouteInput.jsx`：负责起点终点输入和交通方式选择
  - `RouteResult.jsx`：负责路线结果展示
  - `RoutePlanning.jsx`：负责路线计算和数据处理

2. 路线计算流程：

```javascript
const getRouteService = (mode) => {
  switch (mode) {
    case 'drive':
      return new AMap.Driving({
        policy: AMap.DrivingPolicy.LEAST_TIME,
      });
    case 'walk':
      return new AMap.Walking();
    case 'bus':
      return new AMap.Transfer({
        city: '北京',
        policy: AMap.TransferPolicy.LEAST_TIME,
      });
    default:
      return new AMap.Driving();
  }
};

// 计算路线
const calculateRoute = (origin, destination, mode) => {
  const service = getRouteService(mode);

  service.search([origin, destination], (status, result) => {
    if (status === 'complete') {
      // 处理路线结果
      handleRouteResult(result);
    } else {
      // 处理错误
      handleRouteError(status, result);
    }
  });
};
```

### 4.3 路线收藏功能开发

1. 数据存储：
   - 使用 localStorage 存储收藏的路线
   - 存储键名：`routePlanning_favorites`
   - 存储格式：JSON字符串

2. 收藏管理 API：
  ```javascript
   // 获取所有收藏的路线
   const getFavorites = () => {
     const favorites = localStorage.getItem('routePlanning_favorites');
     return favorites ? JSON.parse(favorites) : [];
   };
   
   // 添加收藏
   const addFavorite = (route) => {
     const favorites = getFavorites();
     favorites.push(route);
     localStorage.setItem('routePlanning_favorites', JSON.stringify(favorites));
   };
   
   // 更新收藏
   const updateFavorite = (id, updatedRoute) => {
     const favorites = getFavorites();
     const index = favorites.findIndex(route => route.id === id);
     if (index !== -1) {
       favorites[index] = updatedRoute;
       localStorage.setItem('routePlanning_favorites', JSON.stringify(favorites));
     }
   };
   
   // 删除收藏
   const deleteFavorite = (id) => {
     const favorites = getFavorites();
     const filteredFavorites = favorites.filter(route => route.id !== id);
     localStorage.setItem('routePlanning_favorites', JSON.stringify(filteredFavorites));
   };
  ```

## 5. 路由配置

### 5.1 路由结构

```javascript
// src/routes.jsx
import { createBrowserRouter } from 'react-router-dom';
import App from './App';
import HomePage from './pages/HomePage';
import AboutPage from './pages/AboutPage';

const router = createBrowserRouter([
  {
    path: '/',
    element: <App />,
    children: [
      {
        index: true,
        element: <HomePage />
      },
      {
        path: 'about',
        element: <AboutPage />
      }
    ]
  }
]);

export default router;
```

### 5.2 路由使用

```javascript
// src/main.jsx
import { RouterProvider } from 'react-router-dom';
import router from './routes';

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <RouterProvider router={router} />
  </React.StrictMode>
);
```

## 6. 样式管理

### 6.1 Tailwind CSS 配置

- 使用 Tailwind CSS 4.x 进行样式管理
- 配置文件：`tailwind.config.js`（如需要自定义配置）
- 在 `index.css` 中导入 Tailwind 基础样式

```css
/* src/index.css */
@tailwind base;
@tailwind components;
@tailwind utilities;

/* 自定义样式 */
body {
  margin: 0;
  padding: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
```

### 6.2 组件样式

- 优先使用 Tailwind 类名进行样式编写
- 对于复杂组件，可以使用 CSS Modules 或 styled-components
- 保持样式的一致性和可维护性

## 7. 代码规范

### 7.1 ESLint 配置

- 项目使用 ESLint 进行代码检查
- 配置文件：`eslint.config.js`
- 规则基于 `@eslint/js` 和 `eslint-plugin-react-hooks`

### 7.2 代码风格

- 使用 React Hooks 编写函数组件
- 优先使用函数式编程
- 保持组件的单一职责
- 合理使用状态管理
- 编写清晰的注释

## 8. 部署

### 8.1 构建项目

```bash
pnpm build
```

构建产物将输出到 `dist` 目录。

### 8.2 部署方式

#### 8.2.1 GitHub Pages

1. 安装 `gh-pages` 依赖：
   ```bash
   pnpm add -D gh-pages
   ```

2. 在 `package.json` 中添加脚本：
   ```json
   "scripts": {
     "deploy": "gh-pages -d dist"
   }
   ```

3. 部署到 GitHub Pages：
   ```bash
   pnpm deploy
   ```

#### 8.2.2 Vercel

1. 注册 Vercel 账号：https://vercel.com/
2. 连接 GitHub 仓库
3. 选择项目并点击 "Deploy"
4. 等待部署完成，获取部署链接

#### 8.2.3 自定义服务器

1. 将 `dist` 目录下的文件上传到服务器
2. 配置 Nginx 或 Apache 服务器
3. 示例 Nginx 配置：
   ```nginx
   server {
     listen 80;
     server_name your-domain.com;
     root /path/to/dist;
     index index.html;
     
     location / {
       try_files $uri $uri/ /index.html;
     }
   }
   ```

## 11. 维护与更新

### 11.1 依赖更新

```bash
# 检查依赖更新
pnpm outdated

# 更新依赖
pnpm update

# 更新到最新版本
pnpm update --latest
```

### 11.2 代码更新流程

1. 创建新的分支：
   ```bash
   git checkout -b feature/new-feature
   ```

2. 开发新功能或修复 bug
3. 提交代码：
   ```bash
   git add .
   git commit -m "feat: add new feature"
   ```

4. 推送到远程仓库：
   ```bash
   git push origin feature/new-feature
   ```

5. 创建 Pull Request
6. 代码审查通过后，合并到主分支
7. 部署更新

## 12. 常见问题与解决方案

### 12.1 高德地图 API 加载失败

- 检查 API 密钥是否正确
- 检查网络连接是否正常
- 检查域名是否在高德地图 API 的白名单中

### 12.2 路线计算失败

- 检查起点和终点是否正确
- 检查交通方式是否支持该路线
- 检查高德地图 API 是否返回错误信息

### 12.3 本地存储数据丢失

- 检查浏览器是否支持 localStorage
- 检查浏览器是否开启了隐私模式
- 检查 localStorage 是否被手动清除

## 13. 技术栈学习资源

### 13.1 React

- [React 官方文档](https://react.dev/)
- [React 入门教程](https://zh-hans.react.dev/learn)

### 13.2 Vite

- [Vite 官方文档](https://vite.dev/)
- [Vite 中文文档](https://cn.vite.dev/)

### 13.3 React Router

- [React Router 官方文档](https://reactrouter.com/)

### 13.4 Tailwind CSS

- [Tailwind CSS 官方文档](https://tailwindcss.com/)
- [Tailwind CSS 中文文档](https://www.tailwindcss.cn/)

### 13.5 高德地图 API

- [高德地图 JS API 官方文档](https://lbs.amap.com/api/javascript-api/guide/abc/quickstart)

## 14. 贡献指南

1. Fork 本仓库
2. 创建新的分支
3. 开发新功能或修复 bug
4. 提交代码
5. 创建 Pull Request
6. 等待代码审查
7. 代码审查通过后，合并到主分支

## 15. 开源协议

本项目采用 MIT License 开源协议。
